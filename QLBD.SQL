-- Drop the database 'DatabaseName'
-- Connect to the 'master' database to run this snippet
USE master
GO
-- Uncomment the ALTER DATABASE statement below to set the database to SINGLE_USER mode if the drop database command fails because the database is in use.
-- ALTER DATABASE DatabaseName SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
-- Drop the database if it exists
IF EXISTS (
  SELECT name
   FROM sys.databases
   WHERE name = N'QLBongDa'
)
DROP DATABASE QLBongDa
GO

-- Create a new database called 'QLBongDa'
-- Connect to the 'master' database to run this snippet
USE master
GO
-- Create the new database if it does not exist already
IF NOT EXISTS (
    SELECT name
        FROM sys.databases
        WHERE name = N'QLBongDa'
)
CREATE DATABASE QLBongDa
GO


USE QLBongDa
GO
CREATE TABLE TINH (
	MATINH VARCHAR(5) NOT NULL,
    TENTINH NVARCHAR(100) NOT NULL,
    PRIMARY KEY (MATINH)
);


CREATE TABLE QUOCGIA (
	MAQG VARCHAR(5) NOT NULL,
    TENQG NVARCHAR(60) NOT NULL,
    PRIMARY KEY (MAQG)
);


CREATE TABLE HUANLUYENVIEN (
	MAHLV VARCHAR(5) NOT NULL,
    TENHLV NVARCHAR(100) NOT NULL,
    NGAYSINH DATETIME,
    DIACHI NVARCHAR(200),
    DIENTHOAI NVARCHAR(20),
    MAQG VARCHAR(5),
    PRIMARY KEY (MAHLV),
    CONSTRAINT FK_MAQG FOREIGN KEY (MAQG) REFERENCES QUOCGIA (MAQG)
);


CREATE TABLE SANVD (
	MASAN VARCHAR(5) NOT NULL,
    TENSAN NVARCHAR(100) NOT NULL,
    DIACHI NVARCHAR(200),
    PRIMARY KEY (MASAN)
);


CREATE TABLE CAULACBO (
	MACLB VARCHAR(5) NOT NULL,
    TENCLB NVARCHAR(100) NOT NULL,
    MASAN VARCHAR(5) NOT NULL,
    MATINH VARCHAR(5) NOT NULL,
    PRIMARY KEY (MACLB),
    CONSTRAINT FK_MASAN FOREIGN KEY (MASAN) REFERENCES SANVD (MASAN),
	CONSTRAINT FK_MATINH FOREIGN KEY (MATINH) REFERENCES TINH (MATINH)
);


CREATE TABLE CAUTHU (
	MACT NUMERIC NOT NULL,
    HOTEN NVARCHAR(100) NOT NULL,
    VITRI NVARCHAR(20) NOT NULL,
    NGAYSINH DATETIME,
    DIACHI NVARCHAR(200),
    MACLB VARCHAR(5) NOT NULL,
    MAQG VARCHAR(5) NOT NULL,
    SO INT NOT NULL,
    PRIMARY KEY (MACT),
    CONSTRAINT FK_CLB FOREIGN KEY (MACLB) REFERENCES CAULACBO (MACLB)
);


CREATE TABLE TRANDAU(
	MATRAN NUMERIC NOT NULL,
    NAM INT NOT NULL,
    VONG INT NOT NULL,
    NGAYTD DATETIME NOT NULL,
    MACLB1 VARCHAR(5) NOT NULL,
    MACLB2 VARCHAR(5) NOT NULL,
    MASAN VARCHAR(5) NOT NULL,
    KETQUA VARCHAR(5) NOT NULL,
	PRIMARY KEY (MATRAN),
    CONSTRAINT FK_MASAN0 FOREIGN KEY (MASAN) REFERENCES SANVD (MASAN),
    CONSTRAINT FK_MACLB1 FOREIGN KEY (MACLB1) REFERENCES CAULACBO (MACLB),
	CONSTRAINT FK_MACLB2 FOREIGN KEY (MACLB2) REFERENCES CAULACBO (MACLB)
);


CREATE TABLE BANGXH(
	MACLB VARCHAR(5) NOT NULL,
    NAM INT NOT NULL,
    VONG INT NOT NULL,
    SOTRAN INT NOT NULL,
    THANG INT NOT NULL,
    HOA INT NOT NULL,
    THUA INT NOT NULL,
    HIEUSO VARCHAR(5) NOT NULL,
    DIEM INT NOT NULL,
    HANG INT NOT NULL,
	PRIMARY KEY (MACLB, NAM, VONG),
	CONSTRAINT FK_MACLB0 FOREIGN KEY (MACLB) REFERENCES CAULACBO (MACLB)
);


CREATE TABLE HLV_CLB(
	MAHLV VARCHAR(5) NOT NULL,
    MACLB VARCHAR(5) NOT NULL,
    VAITRO NVARCHAR(100) NOT NULL,
	PRIMARY KEY (MAHLV, MACLB),
	CONSTRAINT FK_MAHLV FOREIGN KEY (MAHLV) REFERENCES HUANLUYENVIEN (MAHLV),
    CONSTRAINT FK_MACLB3 FOREIGN KEY (MACLB) REFERENCES CAULACBO (MACLB)
);
GO


